# scan_for_malware.py

from django.core.management.base import BaseCommand
import os
import clamd  

class Command(BaseCommand):
    help = 'Scan a directory for malware'

    def add_arguments(self, parser):
        parser.add_argument('directory', type=str, help='Directory to scan for malware')

    def handle(self, *args, **kwargs):
        directory = kwargs['directory']
        if os.path.exists(directory) and os.path.isdir(directory):
            cd = clamd.ClamdUnixSocket()
            try:
                scan_results = cd.scan(directory)
                self.stdout.write(f"Malware scan results for directory '{directory}':\n{scan_results}")
            except Exception as e:
                self.stdout.write(f"Error during malware scan: {str(e)}")
        else:
            self.stdout.write(f"Directory '{directory}' does not exist or is not a valid directory path.")
